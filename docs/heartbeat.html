<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <title>Heartbeat — Superbot Docs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            ink: '#0a0a0a',
            surface: '#141414',
            parchment: '#d4cdc4',
            stone: '#706b63',
            sand: '#c4a882', ember: '#DC504A',
            moss: '#8a9a7b',
            border: '#1f1f1e',
            codebg: '#111110',
          },
          fontFamily: {
            mono: ['"Space Mono"', 'monospace'],
            heading: ['"Space Mono"', 'monospace'],
            body: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #2a2a28; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #3a3a38; }

    /* Selection */
    ::selection { background: rgba(196, 168, 130, 0.25); color: #d4cdc4; }

    /* Fade-in animations */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-up {
      opacity: 0;
      animation: fadeUp 0.6s ease-out forwards;
    }
    .fade-in {
      opacity: 0;
      animation: fadeIn 0.5s ease-out forwards;
    }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
    .delay-5 { animation-delay: 0.5s; }
    .delay-6 { animation-delay: 0.6s; }
    .delay-7 { animation-delay: 0.7s; }
    .delay-8 { animation-delay: 0.8s; }

    /* Sidebar active indicator */
    .nav-link { position: relative; transition: color 0.2s ease, background 0.2s ease; }
    .nav-link::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 2px;
      height: 0;
      background: #DC504A;
      transition: height 0.2s ease;
    }
    .nav-link:hover::before, .nav-link.active::before { height: 60%; }
    .nav-link.active { color: #DC504A; }

    /* Intersection Observer reveals */
    .reveal {
      opacity: 0;
      transform: translateY(16px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Mobile sidebar */
    @media (max-width: 1024px) {
      .sidebar-panel {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      .sidebar-panel.open {
        transform: translateX(0);
      }
    }
  </style>
</head>
<body class="bg-ink text-parchment font-body leading-relaxed min-h-screen">

  <!-- Mobile toggle -->
  <button id="mobile-toggle" class="lg:hidden fixed top-5 left-5 z-[200] bg-surface border border-border rounded px-2.5 py-2 text-parchment/70 hover:text-parchment transition-colors">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>

  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black/50 z-[90] hidden lg:hidden" onclick="toggleSidebar()"></div>

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar-panel w-[260px] flex-shrink-0 bg-surface border-r border-border fixed top-0 left-0 bottom-0 z-[100] overflow-y-auto lg:translate-x-0">
      <div class="px-6 pt-8 pb-6 border-b border-border">
        <a href="index.html" class="no-underline">
          <img src="superbotlogo.svg" alt="superbot" class="h-6">
          <span class="text-stone text-xs tracking-[0.15em] uppercase mt-1 block">documentation</span>
        </a>
      </div>
      <nav class="px-4 py-6 space-y-1">
        <a href="index.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Home</a>
        <a href="getting-started.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Getting Started</a>

        <div class="text-[10px] font-medium tracking-[0.15em] uppercase text-stone/60 px-4 pt-6 pb-2">Features</div>
        <a href="commands.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Commands</a>
        <a href="memory.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Memory</a>
        <a href="heartbeat.html" class="nav-link active block px-4 py-2 text-sm rounded text-ember">Heartbeat</a>
        <a href="scheduler.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Scheduler</a>
        <a href="slack.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Slack</a>
        <a href="skills.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Skills</a>


        <div class="text-[10px] font-medium tracking-[0.15em] uppercase text-stone/60 px-4 pt-6 pb-2">Reference</div>
        <a href="architecture.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">Architecture</a>
        <a href="prompt.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">System Prompt</a>
        <a href="files.html" class="nav-link block px-4 py-2 text-sm rounded text-stone hover:text-parchment">File Reference</a>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="flex-1 lg:ml-[260px] px-6 md:px-12 lg:px-16 py-16 md:py-20 max-w-[860px]">

      <!-- Header -->
      <div class="mb-12 fade-up">
        <h1 class="font-heading text-4xl md:text-5xl font-light tracking-wide text-parchment leading-[1.1] mb-4">Heartbeat System</h1>
        <p class="text-stone text-lg fade-up delay-1">Background task processing with team messaging.</p>
      </div>

      <!-- What Is the Heartbeat? -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 fade-up delay-2">What Is the Heartbeat?</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">The heartbeat is your awareness loop and work queue, checked every 30 minutes by a background worker. It has two types of items: <strong class="text-parchment font-medium">recurring checks</strong> (permanent monitoring items scanned every cycle) and <strong class="text-parchment font-medium">work items</strong> (one-off tasks that get checked off when done).</p>
      <p class="text-stone leading-relaxed mb-4 reveal">The heartbeat worker is a separate Claude agent (using Opus by default, configurable via <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">heartbeat.model</code> in config.json) that runs as a <strong class="text-parchment font-medium">teammate</strong> using team messaging. For space-tagged work orders, it notifies superbot, which spawns a space worker via <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">spawn-worker.sh --space</code>. If you're not online, messages wait in your inbox and appear next time you launch superbot.</p>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Adding Tasks -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Adding Tasks</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">Just ask superbot to add a heartbeat item, or edit <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.superbot/HEARTBEAT.md</code> directly. There are two sections:</p>
      <pre class="bg-codebg border border-border rounded-lg p-4 font-mono text-sm text-sand/80 mb-6 overflow-x-auto reveal">## Recurring Checks
- Check on myspace [myspace] &mdash; any stale tasks? progress?
- Scan for latest AI news &mdash; anything worth sharing?

## Active
- [ ] Run tests on main branch
- [ ] Summarize my open PRs</pre>
      <p class="text-stone leading-relaxed mb-4 reveal"><strong class="text-parchment font-medium">Recurring checks</strong> have no checkbox &mdash; they stay on the list permanently and are scanned every heartbeat cycle. <strong class="text-parchment font-medium">Work items</strong> use checkboxes and get marked <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">[x]</code> when completed.</p>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- How the Worker Runs -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">How the Worker Runs</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">Every 30 minutes, <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">heartbeat-cron.sh</code> runs via macOS launchd. It first runs the <a href="memory.html" class="text-sand/80 hover:text-sand transition-colors border-b border-sand/20 hover:border-sand/50">session observer</a> to capture recent activity to daily notes, then checks for pending tasks:</p>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">1. Guard checks</h3>
      <ul class="text-stone space-y-2 mb-6 list-disc list-inside reveal">
        <li>Is the team set up? (<code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.claude/teams/superbot/config.json</code> must exist)</li>
        <li>Does the worker prompt exist? (<code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.superbot/prompts/heartbeat.md</code>)</li>
      </ul>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">2. Triage</h3>
      <p class="text-stone leading-relaxed mb-4 reveal">Runs <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">triage.sh</code> which uses the Haiku model (cheap and fast) to answer one question: "Are there unchecked, actionable tasks?" Response is just YES or NO.</p>
      <p class="text-stone leading-relaxed mb-4 reveal">If NO, the script logs "nothing to do" and exits. This saves compute on quiet periods.</p>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">3. Spawn worker</h3>
      <p class="text-stone leading-relaxed mb-4 reveal">If YES, the cron script:</p>
      <ol class="text-stone space-y-2 mb-6 list-decimal list-inside reveal">
        <li>Reads all context files (IDENTITY, USER, MEMORY, HEARTBEAT)</li>
        <li>Builds a system prompt with the worker instructions and all context</li>
        <li>Drops a kickoff message in the heartbeat worker's inbox with the pending tasks</li>
        <li>Spawns a Claude teammate with full tool access</li>
      </ol>
      <p class="text-stone leading-relaxed mb-4 reveal">For space-tagged work orders (e.g. <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">- [ ] Work on summary [summary]</code>), the heartbeat worker notifies superbot instead of doing the work itself. Superbot then spawns a space worker via <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">spawn-worker.sh --space &lt;slug&gt;</code>.</p>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">4. Worker processes tasks</h3>
      <p class="text-stone leading-relaxed mb-4 reveal">The worker follows instructions in <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">prompts/heartbeat.md</code>:</p>
      <ol class="text-stone space-y-2 mb-6 list-decimal list-inside reveal">
        <li>Reads HEARTBEAT.md for unchecked tasks</li>
        <li>Messages superbot with a summary of tasks found</li>
        <li>Works through each task one at a time</li>
        <li>Marks completed tasks: <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">- [x]</code> with a timestamped note</li>
        <li>Messages superbot with a completion summary</li>
        <li>Appends completed task summaries to today's daily notes</li>
        <li>Updates MEMORY.md if it learned something worth keeping</li>
      </ol>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">5. Results</h3>
      <p class="text-stone leading-relaxed mb-4 reveal">After the worker finishes, HEARTBEAT.md looks like:</p>
      <pre class="bg-codebg border border-border rounded-lg p-4 font-mono text-sm text-sand/80 mb-6 overflow-x-auto reveal">## Tasks
- [x] Run tests on main branch
  &gt; 2026-02-05 3:30pm - All 47 tests passed
- [ ] Review PR #42
  &gt; 2026-02-05 3:30pm - Skipped: needs user decision on API design</pre>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Team Messaging -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Team Messaging</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">The heartbeat worker communicates via team messaging, not just file edits. Messages go to <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.claude/teams/superbot/inboxes/superbot.json</code>.</p>
      <p class="text-stone leading-relaxed mb-4 reveal">You'll always get at least two messages from the worker:</p>
      <ul class="text-stone space-y-2 mb-6 list-disc list-inside reveal">
        <li><strong class="text-parchment font-medium">Start</strong> &mdash; what tasks it found</li>
        <li><strong class="text-parchment font-medium">End</strong> &mdash; what it did</li>
      </ul>
      <p class="text-stone leading-relaxed mb-4 reveal">If you're in an active superbot session, messages appear in real-time. Otherwise they're queued in your inbox.</p>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Kickoff Message Flow -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Kickoff Message Flow</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">Before spawning the worker, the cron script drops a message in the heartbeat inbox:</p>
      <pre class="bg-codebg border border-border rounded-lg p-4 font-mono text-sm text-sand/80 mb-6 overflow-x-auto reveal">Hey heartbeat - I've got work for you. Here are the pending tasks:

Run tests on main branch
Summarize my open PRs

If you need any additional context before starting,
message me and ask. Otherwise, go ahead and get to work.</pre>
      <p class="text-stone leading-relaxed mb-4 reveal">This ensures the worker has immediate context when it starts up.</p>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Worker Constraints -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Worker Constraints</h2>
      <ul class="text-stone space-y-2 mb-6 list-disc list-inside reveal">
        <li>Won't start tasks that require user input or decisions</li>
        <li>Won't make destructive changes without explicit permission in the task</li>
        <li>Full tool access &mdash; can use WebSearch, MCP servers, and all standard tools</li>
        <li>Keeps notes brief &mdash; one line per task</li>
      </ul>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Managing Tasks -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Managing Tasks</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">Ask superbot to list, clear, or trigger heartbeat tasks — or edit <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">HEARTBEAT.md</code> directly. Use <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">/superbot:status</code> to see a summary of pending vs completed tasks.</p>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Installing the Heartbeat -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Installing the Heartbeat</h2>
      <p class="text-stone leading-relaxed mb-4 reveal">The heartbeat is installed automatically during onboarding. To install manually:</p>
      <pre class="bg-codebg border border-border rounded-lg p-4 font-mono text-sm text-sand/80 mb-6 overflow-x-auto reveal">~/superbot/scripts/install-heartbeat.sh</pre>
      <p class="text-stone leading-relaxed mb-4 reveal">The interval is read from <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">heartbeat.intervalMinutes</code> in config.json (default: 30 minutes).</p>

      <h3 class="font-heading text-xl font-light mb-4 mt-8 reveal">Changing the interval</h3>
      <p class="text-stone leading-relaxed mb-4 reveal">Update <code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">heartbeat.intervalMinutes</code> in config.json, then re-run the install script:</p>
      <pre class="bg-codebg border border-border rounded-lg p-4 font-mono text-sm text-sand/80 mb-6 overflow-x-auto reveal">~/superbot/scripts/install-heartbeat.sh</pre>

      <!-- Divider -->
      <div class="w-12 h-px bg-sand/30 my-12"></div>

      <!-- Logs -->
      <h2 class="font-heading text-2xl font-light tracking-wide border-b border-border pb-2 mb-6 mt-16 reveal">Logs</h2>
      <div class="overflow-x-auto mb-6 reveal">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-border">
              <th class="text-left py-3 pr-6 text-parchment font-medium">Log</th>
              <th class="text-left py-3 text-parchment font-medium">Contents</th>
            </tr>
          </thead>
          <tbody class="text-stone">
            <tr class="border-b border-border/50">
              <td class="py-3 pr-6"><code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.superbot/logs/heartbeat.log</code></td>
              <td class="py-3">Triage decisions, worker spawning, completion</td>
            </tr>
            <tr class="border-b border-border/50">
              <td class="py-3 pr-6"><code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.superbot/logs/heartbeat-stdout.log</code></td>
              <td class="py-3">Launchd stdout output</td>
            </tr>
            <tr>
              <td class="py-3 pr-6"><code class="bg-codebg px-1.5 py-0.5 rounded text-sand/80 font-mono text-sm">~/.superbot/logs/heartbeat-stderr.log</code></td>
              <td class="py-3">Launchd stderr output</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Footer -->
      <div class="w-full h-px bg-border mb-8 mt-16"></div>
      <footer class="text-stone/40 text-xs tracking-wide">
        superbot
      </footer>

    </main>
  </div>

  <script>
    // Mobile sidebar toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('overlay').classList.toggle('hidden');
    }
    document.getElementById('mobile-toggle').addEventListener('click', toggleSidebar);

    // Intersection Observer for scroll reveals
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.classList.add('visible');
          }, index * 40);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.05, rootMargin: '0px 0px 50px 0px' });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  </script>
</body>
</html>
